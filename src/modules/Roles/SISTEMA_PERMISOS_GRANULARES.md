# üõ°Ô∏è SISTEMA DE PERMISOS GRANULARES - GU√çA PARA DESARROLLADORES

Hemos implementado un sistema de permisos granulares que permite controlar exactamente qu√© puede hacer cada usuario en cada m√≥dulo de la aplicaci√≥n. **Los permisos se definen una sola vez al crear roles**, y luego cada m√≥dulo consulta autom√°ticamente esos permisos.

---

## üéØ **¬øC√ìMO FUNCIONA EL SISTEMA?**

### **1. FLUJO GENERAL**

```
ADMIN CREA ROL ‚Üí USUARIO RECIBE ROL ‚Üí M√ìDULOS CONSULTAN PERMISOS ‚Üí UI SE ADAPTA
```

### **2. EJEMPLO PR√ÅCTICO**

**Paso 1: Admin crea rol "Editor de Contenido"**

```javascript
// En el modal de roles, el admin selecciona:
Rol "Editor de Contenido" = {
  permissions: {
    users: { Ver: true, Crear: false, Editar: false, Eliminar: false },
    sportsEquipment: { Ver: true, Crear: true, Editar: true, Eliminar: false },
    donationsManagement: { Ver: true, Crear: true, Editar: true, Eliminar: true }
  }
}
```

**Paso 2: Usuario "Jennifer" recibe el rol**

```javascript
Usuario "Jennifer" = {
  name: "Jennifer Lascarro",
  role: "Editor de Contenido" // ‚Üê Hereda TODOS los permisos del rol
}
```

**Paso 3: Los m√≥dulos consultan autom√°ticamente**

```javascript
// En el m√≥dulo de Usuarios
hasPermission("users", "Crear"); // ‚Üí false (bot√≥n oculto)

// En el m√≥dulo de Material Deportivo
hasPermission("sportsEquipment", "Crear"); // ‚Üí true (bot√≥n visible)
```

---

## üöÄ **C√ìMO IMPLEMENTAR EN TU M√ìDULO (3 PASOS SIMPLES)**

### **PASO 1: Agregar Importaciones (2 l√≠neas)**

```jsx
// Al inicio de tu componente, agregar estas 2 l√≠neas:
import PermissionGuard from "../../../../../../shared/components/PermissionGuard";
import { usePermissions } from "../../../../../../shared/hooks/usePermissions";
```

### **PASO 2: Usar el Hook (1 l√≠nea)**

```jsx
const TuModulo = () => {
  const { hasPermission } = usePermissions(); // ‚Üê Agregar esta l√≠nea
  // ... resto de tu c√≥digo existente (no cambiar nada m√°s)
};
```

### **PASO 3: Proteger Elementos**

**A) Proteger Botones:**

```jsx
{
  /* Envolver botones importantes con PermissionGuard */
}
<PermissionGuard module="tuModulo" action="Crear">
  <button onClick={handleCreate}>
    <FaPlus /> Crear
  </button>
</PermissionGuard>;
```

**B) Configurar Tabla:**

```jsx
<Table
  // Cambiar estas l√≠neas:
  onEdit={hasPermission("tuModulo", "Editar") ? handleEdit : null}
  onDelete={hasPermission("tuModulo", "Eliminar") ? handleDelete : null}
  onView={hasPermission("tuModulo", "Ver") ? handleView : null}
  // Agregar esta configuraci√≥n:
  buttonConfig={{
    edit: (item) => ({ show: hasPermission("tuModulo", "Editar") }),
    delete: (item) => ({ show: hasPermission("tuModulo", "Eliminar") }),
    view: (item) => ({ show: hasPermission("tuModulo", "Ver") }),
  }}
/>
```

**C) Verificar en Funciones:**

```jsx
const handleEdit = (item) => {
  // Agregar esta verificaci√≥n al inicio:
  if (!hasPermission('tuModulo', 'Editar')) {
    showErrorAlert('Sin permisos', 'No tienes permisos para editar');
    return;
  }
  // ... tu c√≥digo existente
};
  }}
/>;
```

---

## üìù **NOMBRES DE M√ìDULOS DISPONIBLES**

**IMPORTANTE**: Usa exactamente estos nombres en tu c√≥digo:

```javascript
const MODULOS_DISPONIBLES = [
  "dashboard", // Dashboard principal
  "users", // Usuarios
  "roles", // Roles y permisos
  "sportsEquipment", // Material deportivo
  "employees", // Empleados
  "employeesSchedule", // Horario de empleados
  "appointmentManagement", // Gesti√≥n de citas
  "sportsCategory", // Categor√≠as deportivas
  "athletesSection", // Gesti√≥n de deportistas
  "athletesAssistance", // Asistencia de deportistas
  "donorsSponsors", // Donantes y patrocinadores
  "donationsManagement", // Gesti√≥n de donaciones
  "eventsManagement", // Gesti√≥n de eventos
  "temporaryWorkers", // Trabajadores temporales
  "temporaryTeams", // Equipos temporales
  "providers", // Proveedores
  "purchasesManagement", // Gesti√≥n de compras
];
```

**ACCIONES DISPONIBLES:**

```javascript
const ACCIONES_DISPONIBLES = ["Ver", "Crear", "Editar", "Eliminar"];
```

---

## üéØ **EJEMPLOS ESPEC√çFICOS POR M√ìDULO**

### **EMPLEADOS**

```jsx
// Reemplaza "employees" por tu m√≥dulo espec√≠fico
<PermissionGuard module="employees" action="Crear">
  <button onClick={handleCreateEmployee}>Crear Empleado</button>
</PermissionGuard>

// En la tabla
onEdit={hasPermission('employees', 'Editar') ? handleEdit : null}
```

### **CITAS**

```jsx
// Reemplaza "appointmentManagement" por tu m√≥dulo espec√≠fico
<PermissionGuard module="appointmentManagement" action="Crear">
  <button onClick={handleCreateAppointment}>Crear Cita</button>
</PermissionGuard>
```

### **DONACIONES**

```jsx
// Reemplaza "donationsManagement" por tu m√≥dulo espec√≠fico
<PermissionGuard module="donationsManagement" action="Ver">
  <ReportButton data={donations} />
</PermissionGuard>
```

---

## ‚úÖ **EJEMPLO COMPLETO FUNCIONAL**

```jsx
import React, { useState } from "react";
import { FaPlus } from "react-icons/fa";
import PermissionGuard from "../../../../../../shared/components/PermissionGuard";
import { usePermissions } from "../../../../../../shared/hooks/usePermissions";
import Table from "../../../../../../shared/components/Table/table";
import { showErrorAlert } from "../../../../../../shared/utils/alerts";

const MiModulo = () => {
  const { hasPermission } = usePermissions(); // ‚Üê Hook de permisos
  const [data, setData] = useState([]);

  const handleCreate = () => {
    // Tu l√≥gica existente
  };

  const handleEdit = (item) => {
    if (!hasPermission("miModulo", "Editar")) {
      showErrorAlert("Sin permisos", "No tienes permisos para editar");
      return;
    }
    // Tu l√≥gica existente
  };

  const handleDelete = (item) => {
    if (!hasPermission("miModulo", "Eliminar")) {
      showErrorAlert("Sin permisos", "No tienes permisos para eliminar");
      return;
    }
    // Tu l√≥gica existente
  };

  return (
    <div className="p-6">
      <div className="flex justify-between items-center mb-6">
        <h1 className="text-2xl font-bold">Mi M√≥dulo</h1>

        {/* ‚úÖ BOT√ìN PROTEGIDO */}
        <PermissionGuard module="miModulo" action="Crear">
          <button onClick={handleCreate} className="btn-primary">
            <FaPlus /> Crear
          </button>
        </PermissionGuard>
      </div>

      {/* ‚úÖ TABLA CON PERMISOS */}
      <Table
        thead={{ titles: ["Nombre", "Estado"], state: true, actions: true }}
        tbody={{ data: data, dataPropertys: ["name", "status"], state: true }}
        onEdit={hasPermission("miModulo", "Editar") ? handleEdit : null}
        onDelete={hasPermission("miModulo", "Eliminar") ? handleDelete : null}
        onView={hasPermission("miModulo", "Ver") ? handleView : null}
        buttonConfig={{
          edit: (item) => ({ show: hasPermission("miModulo", "Editar") }),
          delete: (item) => ({ show: hasPermission("miModulo", "Eliminar") }),
          view: (item) => ({ show: hasPermission("miModulo", "Ver") }),
        }}
      />
    </div>
  );
};

export default MiModulo;
```

**¬°Eso es todo!** Con estos 3 pasos simples tu m√≥dulo tendr√° permisos granulares funcionando.

---

## üîß **CASOS ESPECIALES**

### **Verificaci√≥n en L√≥gica de Negocio**

```jsx
const handleSensitiveAction = () => {
  // ‚úÖ Verificar permisos antes de ejecutar
  if (!hasPermission("miModulo", "Editar")) {
    showErrorAlert("Sin permisos", "No tienes permisos para esta acci√≥n");
    return;
  }

  // Continuar con la l√≥gica
  performAction();
};
```

### **M√∫ltiples Permisos**

```jsx
{
  /* Requiere TODOS los permisos */
}
<PermissionGuard
  module={["users", "roles"]}
  action={["Ver", "Editar"]}
  requireAll={true}
>
  <SuperAdminPanel />
</PermissionGuard>;

{
  /* Requiere AL MENOS UNO de los permisos */
}
<PermissionGuard
  module={["donations", "events"]}
  action="Ver"
  requireAll={false}
>
  <ReportsSection />
</PermissionGuard>;
```

### **Botones con L√≥gica Espec√≠fica**

```jsx
buttonConfig={{
  delete: (item) => ({
    show: hasPermission('miModulo', 'Eliminar'),
    disabled: item.hasRelations || item.isSystemItem, // ‚Üê Tu l√≥gica espec√≠fica
    className: (item.hasRelations || item.isSystemItem) ? 'opacity-50 cursor-not-allowed' : '',
    title: item.hasRelations ? 'No se puede eliminar: tiene relaciones' : 'Eliminar'
  })
}}
```

---

## üö® **ERRORES COMUNES A EVITAR**

### ‚ùå **ERROR 1: Nombre de m√≥dulo incorrecto**

```jsx
// ‚ùå MAL
<PermissionGuard module="empleados" action="Crear">

// ‚úÖ BIEN
<PermissionGuard module="employees" action="Crear">
```

### ‚ùå **ERROR 2: Acci√≥n incorrecta**

```jsx
// ‚ùå MAL
<PermissionGuard module="users" action="create">

// ‚úÖ BIEN
<PermissionGuard module="users" action="Crear">
```

### ‚ùå **ERROR 3: No verificar en l√≥gica de negocio**

```jsx
// ‚ùå MAL - Solo oculta el bot√≥n pero no verifica en la funci√≥n
const handleDelete = (item) => {
  deleteItem(item); // ‚Üê Cualquiera puede llamar esta funci√≥n
};

// ‚úÖ BIEN - Verifica permisos en la funci√≥n
const handleDelete = (item) => {
  if (!hasPermission("miModulo", "Eliminar")) {
    showErrorAlert("Sin permisos");
    return;
  }
  deleteItem(item);
};
```

---

## üìä **ESTADO ACTUAL DE IMPLEMENTACI√ìN**

### ‚úÖ **M√ìDULOS COMPLETADOS**

- ‚úÖ **Roles**: 100% implementado
- ‚úÖ **Usuarios**: 100% implementado
- ‚úÖ **Material Deportivo**: 100% implementado

### ‚úÖ **M√ìDULOS RECI√âN COMPLETADOS**

- ‚úÖ **Empleados**: 100% implementado
- ‚úÖ **Horario Empleados**: 100% implementado
- ‚úÖ **Gesti√≥n de Eventos**: 100% implementado
- ‚úÖ **Trabajadores Temporales**: 100% implementado

### ‚ö†Ô∏è **M√ìDULOS PENDIENTES** (ASIGNAR A DESARROLLADORES)

- ‚ùå **Gesti√≥n de Citas** ‚Üí Asignar a: \***\*\_\_\_\*\***
- ‚ùå **Categor√≠as Deportivas** ‚Üí Asignar a: \***\*\_\_\_\*\***
- ‚ùå **Gesti√≥n de Deportistas** ‚Üí Asignar a: \***\*\_\_\_\*\***
- ‚ùå **Asistencia Deportistas** ‚Üí Asignar a: \***\*\_\_\_\*\***
- ‚ùå **Donantes/Patrocinadores** ‚Üí Asignar a: \***\*\_\_\_\*\***
- ‚ùå **Gesti√≥n de Donaciones** ‚Üí Asignar a: \***\*\_\_\_\*\***
- ‚ùå **Equipos Temporales** ‚Üí Asignar a: \***\*\_\_\_\*\***
- ‚ùå **Proveedores** ‚Üí Asignar a: \***\*\_\_\_\*\***
- ‚ùå **Gesti√≥n de Compras** ‚Üí Asignar a: \***\*\_\_\_\*\***

---

## üéØ **CHECKLIST DE IMPLEMENTACI√ìN**

Para cada m√≥dulo, verificar:

- [ ] ‚úÖ Importaciones agregadas (`PermissionGuard`, `usePermissions`)
- [ ] ‚úÖ Hook `hasPermission` implementado
- [ ] ‚úÖ Bot√≥n "Crear" protegido con `PermissionGuard`
- [ ] ‚úÖ Otros botones de acci√≥n protegidos
- [ ] ‚úÖ Tabla configurada con `buttonConfig`
- [ ] ‚úÖ Verificaci√≥n en funciones de negocio
- [ ] ‚úÖ Probado con diferentes roles

---

## üÜò **SOPORTE**

Si tienes dudas durante la implementaci√≥n:

1. **Revisa los m√≥dulos ya implementados**: `Roles.jsx`, `Users.jsx`, `Employees.jsx`, `TemporaryWorkers.jsx`
2. **Consulta este documento**
3. **Pregunta al equipo de arquitectura**

## ‚ö° **RESUMEN R√ÅPIDO**

**Para implementar permisos en cualquier m√≥dulo:**

1. **Importar** `PermissionGuard` y `usePermissions`
2. **Agregar** `const { hasPermission } = usePermissions();`
3. **Envolver botones** con `<PermissionGuard module="tuModulo" action="Crear">`
4. **Configurar tabla** con `hasPermission('tuModulo', 'Accion') ? handler : null`
5. **Verificar en funciones** con `if (!hasPermission(...)) return;`

**¬°No necesitas crear hooks ni configuraciones adicionales!** Todo ya est√° listo para usar.

---

## üéâ **BENEFICIOS DEL SISTEMA**

Una vez implementado completamente:

- ‚úÖ **Seguridad granular**: Control exacto de qu√© puede hacer cada usuario
- ‚úÖ **UX mejorada**: Los usuarios solo ven lo que pueden usar
- ‚úÖ **Mantenimiento f√°cil**: Cambios de permisos desde un solo lugar (roles)
- ‚úÖ **Escalabilidad**: F√°cil agregar nuevos m√≥dulos y permisos
- ‚úÖ **Consistencia**: Comportamiento uniforme en toda la aplicaci√≥n

---
